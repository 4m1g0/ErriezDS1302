\href{https://travis-ci.org/Erriez/ErriezDS1302}{\tt }

This is an optimized 3-\/wire \hyperlink{class_d_s1302}{D\+S1302} R\+TC (Real Time Clock) library for Arduino.



\subsection*{Library features}


\begin{DoxyItemize}
\item Read / write R\+TC date and time.
\item Read / write 31 Bytes battery backupped R\+TC R\+AM.
\item Programmable trickle charge to charge super-\/caps / lithium batteries.
\item Optimized IO interface for Atmel A\+VR platform.
\item Tested on platforms\+:
\begin{DoxyItemize}
\item 8-\/bit Atmel A\+VR (\href{https://store.arduino.cc/arduino-uno-rev3}{\tt Arduino U\+NO} / \href{https://store.arduino.cc/arduino-nano}{\tt Nano} / \href{https://store.arduino.cc/arduino-mini-05}{\tt Mini} / \href{https://store.arduino.cc/arduino-micro}{\tt Micro} / \href{https://store.arduino.cc/arduino-leonardo-with-headers}{\tt Leonardo} / \href{https://store.arduino.cc/arduino-mega-2560-rev3}{\tt Mega2560})
\item 32-\/bit E\+S\+P8266 (\href{https://www.google.com/search?q=wemos+d1+r2&tbm=isch}{\tt We\+Mos D1 \& R2} / \href{https://www.google.com/search?q=geekcreit+esp12e+devkit+v2&tbm=isch}{\tt Node M\+CU E\+S\+P12E})
\item 32-\/bit E\+S\+P32 (\href{https://www.google.com/search?q=wemos+lolin32+oled&tbm=isch}{\tt We\+Mos L\+O\+L\+I\+N32 + O\+L\+ED})
\end{DoxyItemize}
\item Supported I\+DE\textquotesingle{}s\+:
\begin{DoxyItemize}
\item \href{https://www.arduino.cc/en/Main/Software}{\tt Arduino I\+DE} (v1.\+8.\+5)
\item \href{https://www.jetbrains.com/clion/download}{\tt C\+Lion} (2018.\+1)
\item \href{https://atom.io/}{\tt Atom} / \href{https://platformio.org/}{\tt Platform\+IO} with CI (Continuous Integration)
\item \href{https://www.microchip.com/mplab/avr-support/atmel-studio-7}{\tt Atmel Studio} (7.\+0)
\end{DoxyItemize}
\end{DoxyItemize}

\subsection*{\hyperlink{class_d_s1302}{D\+S1302} specifications}

{\bfseries I\+M\+P\+O\+R\+T\+A\+NT N\+O\+T\+ES\+:}


\begin{DoxyItemize}
\item The \hyperlink{class_d_s1302}{D\+S1302} R\+TC time may deviate $>$1 minute each day, so this device is not recommended for designs with high precision requirements.
\item The \href{https://github.com/Erriez/ErriezDS3231}{\tt high precision D\+S3231 I2C R\+TC} is recommended for new designs.
\item The 3-\/wire interface is {\bfseries N\+OT} compatible with S\+PI.
\end{DoxyItemize}

\subsection*{Examples}

Arduino I\+DE $\vert$ File $\vert$ Examples $\vert$ Erriez \hyperlink{class_d_s1302}{D\+S1302} R\+TC\+:


\begin{DoxyItemize}
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/Alarm/Alarm.ino}{\tt Alarm}\+: Program one or more alarms.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/Benchmark/Benchmark.ino}{\tt Benchmark}\+: Benchmark library.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/GettingStarted/GettingStarted.ino}{\tt Getting\+Started}\+: Getting started example.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/PrintDateTime/PrintDateTime.ino}{\tt Print\+Date\+Time}\+: Print date and time with P\+R\+O\+G\+M\+EM strings.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/RAM/RAM.ino}{\tt R\+AM}\+: Read/write R\+TC R\+AM.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/SetDateTime/SetDateTime.ino}{\tt Set\+Date\+Time}\+: Set date time.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/SetTrickleCharger/SetTrickleCharger.ino}{\tt Set\+Trickle\+Charger}\+: Program trickle battery/capacitor charger.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/SquareWave1Hz/SquareWave1Hz.ino}{\tt Square\+Wave1\+Hz}\+: 1\+Hz square wave output on D\+I\+G\+I\+T\+AL pin.
\item \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/Terminal/Terminal.ino}{\tt Terminal} and \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/Terminal/Terminal.py}{\tt Python script} to set date time.
\end{DoxyItemize}

\subsection*{Documentation}


\begin{DoxyItemize}
\item \href{https://erriez.github.io/ErriezDS1302}{\tt Online H\+T\+ML}
\item \href{https://github.com/Erriez/ErriezDS1302/raw/gh-pages/latex/ErriezDS1302.pdf}{\tt Download P\+DF}.
\item \href{https://www.google.com/search?q=DS1302+datasheet}{\tt D\+S1302 datasheet}.
\end{DoxyItemize}

\subsection*{Usage}

{\bfseries Initialization}


\begin{DoxyCode}
1 \{c++\}
2 #include <ErriezDS1302.h>
3 
4 // Connect DS1302 data pin to Arduino DIGITAL pin
5 #if defined(ARDUINO\_ARCH\_AVR)
6 #define DS1302\_CLK\_PIN      2
7 #define DS1302\_IO\_PIN       3
8 #define DS1302\_CE\_PIN       4
9 #elif defined(ARDUINO\_ARCH\_ESP8266)
10 #define DS1302\_CLK\_PIN      D4
11 #define DS1302\_IO\_PIN       D3
12 #define DS1302\_CE\_PIN       D2
13 #elif defined(ARDUINO\_ARCH\_ESP32)
14 #define DS1302\_CLK\_PIN      0
15 #define DS1302\_IO\_PIN       4
16 #define DS1302\_CE\_PIN       5
17 #else
18 #error #error "May work, but not tested on this target"
19 #endif
20 
21 // Create DS1302 RTC object
22 DS1302 rtc = DS1302(DS1302\_CLK\_PIN, DS1302\_IO\_PIN, DS1302\_CE\_PIN);
23 
24 void setup()
25 \{
26     bool running;
27 
28     // Initialize RTC
29     running = rtc.begin();
30 \}
\end{DoxyCode}


{\bfseries Set date and time}


\begin{DoxyCode}
1 \{C++\}
2 DS1302\_DateTime dt;
3 
4 // Set initial date and time
5 dt.second = 0;
6 dt.minute = 41;
7 dt.hour = 22;
8 dt.dayWeek = 6; // 1 = Monday
9 dt.dayMonth = 21;
10 dt.month = 4;
11 dt.year = 2018;
12 rtc.setDateTime(&dt);
\end{DoxyCode}


{\bfseries Get date and time}


\begin{DoxyCode}
1 \{c++\}
2 DS1302\_DateTime dt;
3 char buf[32];
4 
5 // Get RTC date and time
6 if (!rtc.getDateTime(&dt)) \{
7     Serial.println(F("Error: DS1302 read failed"));
8 \} else \{
9     snprintf(buf, sizeof(buf), "%d %02d-%02d-%d %d:%02d:%02d",
10              dt.dayWeek, dt.dayMonth, dt.month, dt.year, dt.hour, dt.minute, dt.second);
11     Serial.println(buf);
12 \}
\end{DoxyCode}


{\bfseries Set time}


\begin{DoxyCode}
1 \{c++\}
2 // Set time
3 rtc.setTime(12, 0, 0);
\end{DoxyCode}


{\bfseries Get time}


\begin{DoxyCode}
1 \{c++\}
2 uint8\_t hour;
3 uint8\_t minute;
4 uint8\_t second;
5 char buf[10];
6 
7 // Read RTC time
8 if (!rtc.getTime(&hour, &minute, &second)) \{
9     Serial.println(F("Error: DS1302 read failed"));
10 \} else \{    
11     // Print time
12     snprintf(buf, sizeof(buf), "%d:%02d:%02d", hour, minute, second);
13     Serial.println(buf);
14 \}
\end{DoxyCode}


{\bfseries Write to R\+TC R\+AM}


\begin{DoxyCode}
1 \{c++\}
2 // Write Byte to RTC RAM
3 rtc.writeByteRAM(0x02, 0xA9);
4 
5 // Write buffer to RTC RAM
6 uint8\_t buf[NUM\_DS1302\_RAM\_REGS] = \{ 0x00 \};
7 rtc.writeBufferRAM(buf, sizeof(buf));
\end{DoxyCode}


{\bfseries Read from R\+TC R\+AM}


\begin{DoxyCode}
1 \{c++\}
2 // Read byte from RTC RAM
3 uint8\_t dataByte = rtc.readByteRAM(0x02);
4 
5 // Read buffer from RTC RAM
6 uint8\_t buf[NUM\_DS1302\_RAM\_REGS];
7 rtc.readBufferRAM(buf, sizeof(buf));
\end{DoxyCode}


{\bfseries Set Trickle Charger}

Please refer to the datasheet how to configure the trickle charger.


\begin{DoxyCode}
1 \{c++\}
2 // Disable (default)
3 rtc.writeClockRegister(DS1302\_REG\_TC, DS1302\_TCS\_DISABLE);
4 
5 // Minimum 2 Diodes, 8kOhm
6 rtc.writeClockRegister(DS1302\_REG\_TC, 0xAB);
7 
8 // Maximum 1 Diode, 2kOhm
9 rtc.writeClockRegister(DS1302\_REG\_TC, 0xA5);
\end{DoxyCode}


{\bfseries Set R\+TC date and time using Python}

Flash \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/Terminal/Terminal.ino}{\tt Terminal} example.

Set C\+OM port in \href{https://github.com/Erriez/ErriezDS1302/blob/master/examples/Terminal/Terminal.py}{\tt examples/\+Terminal/\+Terminal.\+py} Python script.

Run Python script\+:


\begin{DoxyCode}
1 \{c++\}
2 // Install Pyserial
3 python3 pip -m pyserial
4 
5 // Set RTC date and time
6 python3 Terminal.py
\end{DoxyCode}


\subsection*{Pin configuration}

{\bfseries Note\+:} E\+S\+P8266 pin D4 is high during a power cycle / reset / flashing which may corrupt R\+TC registers. For this reason, pins D2 and D4 are swapped.

\tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*5{|X[-1]}|}
\hline
\rowcolor{\tableheadbgcolor}\PBS\centering {\bf \hyperlink{class_d_s1302}{D\+S1302} Pin }&\PBS\centering {\bf \hyperlink{class_d_s1302}{D\+S1302} IC }&\PBS\centering {\bf Atmel A\+VR }&\PBS\centering {\bf E\+S\+P8266 }&\PBS\centering {\bf E\+S\+P32  }\\\cline{1-5}
\endfirsthead
\hline
\endfoot
\hline
\rowcolor{\tableheadbgcolor}\PBS\centering {\bf \hyperlink{class_d_s1302}{D\+S1302} Pin }&\PBS\centering {\bf \hyperlink{class_d_s1302}{D\+S1302} IC }&\PBS\centering {\bf Atmel A\+VR }&\PBS\centering {\bf E\+S\+P8266 }&\PBS\centering {\bf E\+S\+P32  }\\\cline{1-5}
\endhead
\PBS\centering 4 &\PBS\centering G\+ND &\PBS\centering G\+ND &\PBS\centering G\+ND &\PBS\centering G\+ND \\\cline{1-5}
\PBS\centering 8 &\PBS\centering V\+C\+C2 &\PBS\centering 5V (or 3.\+3V) &\PBS\centering 3\+V3 &\PBS\centering 3\+V3 \\\cline{1-5}
\PBS\centering 7 &\PBS\centering S\+C\+LK (C\+LK) &\PBS\centering 2 (D\+I\+G\+I\+T\+AL pin) &\PBS\centering D4 &\PBS\centering 0 \\\cline{1-5}
\PBS\centering 6 &\PBS\centering I/O (D\+AT) &\PBS\centering 3 (D\+I\+G\+I\+T\+AL pin) &\PBS\centering D2 &\PBS\centering 5 \\\cline{1-5}
\PBS\centering 5 &\PBS\centering CE (R\+ST) &\PBS\centering 4 (D\+I\+G\+I\+T\+AL pin) &\PBS\centering D2 &\PBS\centering 4 \\\cline{1-5}
\end{longtabu}
\subsection*{Benchmark results}

\subsubsection*{Arduino U\+NO (A\+VR F\+\_\+\+C\+PU = 16\+M\+Hz)}


\begin{DoxyCode}
1 DS1302 RTC benchmark
2 
3 rtc.begin(): 160us
4 rtc.writeProtect(false): 148us
5 rtc.halt(false): 144us
6 rtc.setDateTime(&dt): 720us
7 rtc.getDateTime(&dt): 496us
8 rtc.setTime(12, 0, 0): 1224us
9 rtc.getTime(&hour, &minute, &second): 272us
10 rtc.writeRAM(0x00, 0xFF): 144us
11 rtc.writeRAM(buf, sizeof(buf): 1796us
12 rtc.readRAM(0x00): 140us
13 rtc.readRAM(buf, sizeof(buf)): 1812us
\end{DoxyCode}


\subsubsection*{We\+Mos D1 \& R2 (E\+S\+P8266 F\+\_\+\+C\+PU = 80\+M\+Hz)}


\begin{DoxyCode}
1 DS1302 RTC benchmark
2 
3 rtc.begin(): 180us
4 rtc.writeProtect(false): 112us
5 rtc.halt(false): 149us
6 rtc.setDateTime(&dt): 369us
7 rtc.getDateTime(&dt): 273us
8 rtc.setTime(12, 0, 0): 571us
9 rtc.getTime(&hour, &minute, &second): 154us
10 rtc.writeRAM(0x00, 0xFF): 86us
11 rtc.writeRAM(buf, sizeof(buf): 852us
12 rtc.readRAM(0x00): 84us
13 rtc.readRAM(buf, sizeof(buf)): 881us
\end{DoxyCode}


\subsubsection*{We\+Mos D1 \& R2 (E\+S\+P8266 F\+\_\+\+C\+PU = 160\+M\+Hz)}


\begin{DoxyCode}
1 DS1302 RTC benchmark
2 
3 rtc.begin(): 152us
4 rtc.writeProtect(false): 73us
5 rtc.halt(false): 108us
6 rtc.setDateTime(&dt): 257us
7 rtc.getDateTime(&dt): 187us
8 rtc.setTime(12, 0, 0): 373us
9 rtc.getTime(&hour, &minute, &second): 105us
10 rtc.writeRAM(0x00, 0xFF): 62us
11 rtc.writeRAM(buf, sizeof(buf): 553us
12 rtc.readRAM(0x00): 62us
13 rtc.readRAM(buf, sizeof(buf)): 568us
\end{DoxyCode}


\subsection*{Library installation}

Please refer to the \href{https://github.com/Erriez/ErriezArduinoLibrariesAndSketches/wiki}{\tt Wiki} page.

\subsection*{Other Arduino Libraries and Sketches from Erriez}


\begin{DoxyItemize}
\item \href{https://github.com/Erriez/ErriezArduinoLibrariesAndSketches}{\tt Erriez Libraries and Sketches} 
\end{DoxyItemize}